import "compiler.mm1";

do {
  (mmc-add '(
    (intrinsic @ proc (sys_write {fd : u32} {count : u32}
      (ghost @ mut {buf : (ref @ array u8 count)}) {p : (&sn buf)} : u32))

    (proc (main {n : u32})
      -- Perform arithmetic with the argument
      {{a : u32} := n}          -- The passed argument (123)
      {{b : u32} := 77}         -- Another number
      {{sum : u32} := (cast {a + b})}  -- Should be 200
      
      -- Display result message
      {{msg : (array u8 35)} := (list . ,(string->list "123 + 77 = 200 (arithmetic works!)\n"))}
      {_ := (sys_write 1 35 msg (& msg))}
      
      -- Return the sum to show computation worked
      {result := sum}
      )
  ))
  
  -- Generate the ELF
  (print (mmc->string))
};