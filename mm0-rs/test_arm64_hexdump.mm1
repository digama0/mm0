import "../examples/compiler.mm1";

do {
  -- Set target to ARM64 macOS first
  (def c mmc-compiler)
  (c 'set-target "arm64-macos")
  
  -- Add write intrinsic and main
  (mmc-add '(
    (intrinsic @ proc (sys_write {fd : u32} {count : u32}
      (ghost @ mut {buf : (ref @ array u8 count)}) {p : (&sn buf)} : u32))

    (proc (main)
      {{hello : (array u8 14)} := (list 72 101 108 108 111 44 32 87 111 114 108 100 33 10)}
      {x := (sys_write 1 14 hello (& hello))}
      (return)
      )
  ))
  
  -- Get the compiled code as string
  (print (c '->string))
};